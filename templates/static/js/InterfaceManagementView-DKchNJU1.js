import{d as E,r as i,c as r,b as w,a,m as B,w as _,v as j,g as h,p as T,k as L,E as H,q as R,s as W,F as I,h as V,x as q,t as C,f as s,_ as A,l as Q,o as G,y as D,z as M,A as F,i as J}from"./index-Cc9b1Oy-.js";import{a as U}from"./django_api-BTHqDO-9.js";const X={class:"simple-data-table"},Y={key:0,class:"table-toolbar"},Z={class:"table-wrapper"},ee=["innerHTML"],te={key:2},ae={key:1,class:"table-pagination"},le=E({__name:"DataTable",props:{data:{default:()=>[]},columns:{default:()=>[]},loading:{type:Boolean,default:!1},pagination:{default:()=>({currentPage:1,pageSize:10,total:0,pageSizes:[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper"})},showPagination:{type:Boolean,default:!0},stripe:{type:Boolean,default:!0},border:{type:Boolean,default:!0}},emits:["page-change","size-change","refresh"],setup(u,{emit:k}){const v=u,f=k,g=i(v.pagination.currentPage||1),m=i(v.pagination.pageSize||10),y=i(v.pagination.total||0),$=o=>{m.value=o,f("size-change",o)},b=o=>{g.value=o,f("page-change",o)};return(o,p)=>{const c=W,z=R,S=H,P=j;return s(),r("div",X,[o.$slots.toolbar?(s(),r("div",Y,[B(o.$slots,"toolbar",{},void 0,!0)])):w("",!0),a("div",Z,[_((s(),h(z,{data:u.data,stripe:u.stripe,border:u.border},{default:T(()=>[u.columns.some(t=>t.type==="selection")?(s(),h(c,{key:0,type:"selection",width:"50"})):w("",!0),u.columns.some(t=>t.type==="index")?(s(),h(c,{key:1,type:"index",width:"60",label:"序号"})):w("",!0),(s(!0),r(I,null,V(u.columns.filter(t=>!t.type||t.type!=="selection"&&t.type!=="index"),t=>(s(),h(c,{key:t.prop,prop:t.prop,label:t.label,width:t.width,"min-width":t.minWidth,sortable:t.sortable,align:t.align,"show-overflow-tooltip":t.showOverflowTooltip},{default:T(d=>[t.renderCell?(s(),h(q(t.renderCell(d)),{key:0})):t.formatter?(s(),r("span",{key:1,innerHTML:t.formatter(d.row,t,d.row[t.prop],d.$index)},null,8,ee)):(s(),r("span",te,C(d.row[t.prop]||"-"),1))]),_:2},1032,["prop","label","width","min-width","sortable","align","show-overflow-tooltip"]))),128)),o.$slots.actions?(s(),h(c,{key:2,label:"操作",width:"150",fixed:"right"},{default:T(t=>[B(o.$slots,"actions",{row:t.row,index:t.$index},void 0,!0)]),_:3})):w("",!0)]),_:3},8,["data","stripe","border"])),[[P,u.loading]])]),u.showPagination&&y.value>0?(s(),r("div",ae,[L(S,{"current-page":g.value,"onUpdate:currentPage":p[0]||(p[0]=t=>g.value=t),"page-size":m.value,"onUpdate:pageSize":p[1]||(p[1]=t=>m.value=t),"page-sizes":u.pagination.pageSizes,layout:u.pagination.layout,total:y.value,onSizeChange:$,onCurrentChange:b},null,8,["current-page","page-size","page-sizes","layout","total"])])):w("",!0)])}}}),ne=A(le,[["__scopeId","data-v-0e07cf90"]]),se={class:"interface-management-container"},oe={class:"filters-container"},ie={class:"filter-row"},re={class:"filter-item"},ue={class:"filter-item"},de=["value"],pe={class:"filter-item"},ce=["value"],ve={class:"filter-item"},ge={key:0,class:"loading"},fe={key:1,class:"error"},me={key:2,class:"interface-table-container"},be=E({__name:"InterfaceManagementView",setup(u){J();const k=i([]),v=i(!0),f=i(null),g=i(1),m=i(10),y=i(0),$=Q(()=>({currentPage:g.value,pageSize:m.value,total:y.value,pageSizes:[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper"})),b=i(""),o=i("all"),p=i("all"),c=i(""),z=i([]),S=[{value:"all",label:"全部状态"},{value:"up",label:"启用"},{value:"down",label:"禁用"},{value:"admin_down",label:"管理关闭"}];async function P(){try{console.log("获取设备列表 - 发送请求");const n=await U.get("/devices/");console.log("获取设备列表 - 响应:",n),z.value=n.data?.results?.map(e=>({id:e.id,name:e.hostname}))||[]}catch(n){console.error("获取设备列表失败:",n)}}const t=i([{prop:"device_name",label:"设备名称",width:150,sortable:!0,formatter:n=>`<span class="clickable" @click="goToDeviceDetails(${n.device_id})"><i class="el-icon-view"></i> ${n.device_name||"-"}</span>`},{prop:"interface_name",label:"接口名称",width:180,sortable:!0},{prop:"description",label:"接口描述",minWidth:200,showOverflowTooltip:!0},{prop:"status",label:"状态",width:120,sortable:!0,formatter:n=>{const e={up:"启用",down:"禁用",admin_down:"管理关闭"};return`<span class="status-badge ${{up:"status-up",down:"status-down",admin_down:"status-admin"}[n.status]||""}">${e[n.status]||n.status}</span>`}}]);async function d(n=1){v.value=!0,f.value=null;try{const e={page:n,page_size:m.value};b.value&&(e.search=b.value),o.value!=="all"&&(e.status=o.value),p.value!=="all"&&(e.device=p.value),c.value&&(e.ip_address=c.value),console.log("发送API请求:",{url:"/config/interfaces/",params:e,baseURL:"/api"});const l=await U.get("/configs/interfaces/",{params:e});console.log("API响应:",l),k.value=l.data?.interfaces||[],y.value=l.data?.count||0,g.value=n}catch(e){console.error("API请求失败:",e),f.value=e instanceof Error?e.message:"获取接口配置失败"}finally{v.value=!1}}function K(){b.value="",o.value="all",p.value="all",c.value="",d(1)}function x(){d(1)}function N(n){g.value=n,d(n)}function O(n){m.value=n,d(1)}return G(async()=>{console.log("组件挂载 - 开始初始化数据"),await P(),console.log("组件挂载 - 设备列表获取完成，开始获取接口数据"),await d(),console.log("组件挂载 - 接口数据获取完成")}),(n,e)=>(s(),r("div",se,[e[11]||(e[11]=a("h2",null,"接口管理",-1)),a("div",oe,[a("div",ie,[a("div",re,[e[5]||(e[5]=a("label",{for:"search"},"搜索:",-1)),_(a("input",{id:"search","onUpdate:modelValue":e[0]||(e[0]=l=>b.value=l),type:"text",placeholder:"搜索接口名称、描述...",onKeyup:M(x,["enter"])},null,544),[[D,b.value]])]),a("div",ue,[e[6]||(e[6]=a("label",{for:"status"},"状态:",-1)),_(a("select",{id:"status","onUpdate:modelValue":e[1]||(e[1]=l=>o.value=l)},[(s(),r(I,null,V(S,l=>a("option",{key:l.value,value:l.value},C(l.label),9,de)),64))],512),[[F,o.value]])]),a("div",pe,[e[8]||(e[8]=a("label",{for:"device"},"设备:",-1)),_(a("select",{id:"device","onUpdate:modelValue":e[2]||(e[2]=l=>p.value=l)},[e[7]||(e[7]=a("option",{value:"all"},"所有设备",-1)),(s(!0),r(I,null,V(z.value,l=>(s(),r("option",{key:l.id,value:l.id},C(l.name),9,ce))),128))],512),[[F,p.value]])]),a("div",ve,[e[9]||(e[9]=a("label",{for:"ip"},"IP地址:",-1)),_(a("input",{id:"ip","onUpdate:modelValue":e[3]||(e[3]=l=>c.value=l),type:"text",placeholder:"例如: 192.168.1.",onKeyup:M(x,["enter"])},null,544),[[D,c.value]])]),a("div",{class:"filter-buttons"},[a("button",{onClick:x,class:"apply-btn"},"应用过滤器"),a("button",{onClick:K,class:"reset-btn"},"重置")])])]),v.value?(s(),r("div",ge,[...e[10]||(e[10]=[a("p",null,"加载中...",-1)])])):f.value?(s(),r("div",fe,[a("p",null,"错误: "+C(f.value),1),a("button",{onClick:e[4]||(e[4]=l=>d(g.value)),class:"retry-btn"},"重试")])):(s(),r("div",me,[L(ne,{data:k.value,columns:t.value,loading:v.value,pagination:$.value,"show-pagination":y.value>0,onPageChange:N,onSizeChange:O},null,8,["data","columns","loading","pagination","show-pagination"])]))]))}}),we=A(be,[["__scopeId","data-v-81491cca"]]);export{we as default};
