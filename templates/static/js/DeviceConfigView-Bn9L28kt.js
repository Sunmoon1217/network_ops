import{d as m,o as b,c as i,a as e,t as d,k as C,i as w,r as c,f as l,_ as D}from"./index-BPjY2MLL.js";import{a as f}from"./django_api-aive4Gka.js";const I={class:"config-container"},$={key:0,class:"loading"},x={key:1,class:"error"},B={key:2,class:"config-content"},E={class:"device-header"},P={class:"header-actions"},U=["disabled"],V={class:"config-section"},A={class:"config-meta"},N={key:0,class:"config-text"},R={key:1,class:"no-config"},S=m({__name:"DeviceConfigView",setup(T){const _=C(),u=w(),t=c(null),g=c(""),r=c(null),n=c(!0),a=c(null),p=c("/devices");function h(){u.options.history.state.back?u.back():u.push(p.value)}async function v(){n.value=!0,a.value=null;try{const o=await f.get(`/devices/${t.value}/`);g.value=o.data?.hostname||"";const s=await f.get(`/devices/${t.value}/config/`);s.data?.success&&s.data?.config&&(r.value=s.data?.config,r.value.id=t.value||0)}catch(o){a.value=o instanceof Error?o.message:"Unknown error"}finally{n.value=!1}}async function k(){console.log("开始获取设备配置..."),console.log(`设备ID: ${t.value}`),n.value=!0,a.value=null;try{console.log(`调用后端API: POST /devices/${t.value}/fetch-config/`);const o=await f.post(`/devices/${t.value}/fetch-config/`);console.log("API调用成功:",o),console.log("重新获取最新配置..."),await v(),console.log("获取配置完成")}catch(o){console.error("获取配置失败:",o),a.value=o instanceof Error?o.message:"Unknown error"}finally{n.value=!1}}function y(){u.push(`/devices/${t.value}/history`)}return b(()=>{const o=_.params.id;typeof o=="string"&&(t.value=parseInt(o),v()),u.options.history.state.back}),(o,s)=>(l(),i("div",I,[s[3]||(s[3]=e("h2",null,"设备配置管理",-1)),n.value?(l(),i("div",$,[...s[0]||(s[0]=[e("p",null,"加载中...",-1)])])):a.value?(l(),i("div",x,[e("p",null,"错误: "+d(a.value),1),e("button",{onClick:v},"重试")])):(l(),i("div",B,[e("div",E,[e("h3",null,"设备: "+d(g.value),1),e("div",P,[e("button",{onClick:h,class:"back-btn"},"返回"),e("button",{onClick:k,class:"fetch-btn",disabled:n.value}," 获取配置 ",8,U),e("button",{onClick:y,class:"history-btn"},"查看历史配置")])]),e("div",V,[s[2]||(s[2]=e("h4",null,"最新配置",-1)),e("div",A,[e("span",null,"保存时间: "+d(r.value?.time),1)]),r.value?(l(),i("pre",N,d(r.value.config_text),1)):(l(),i("div",R,[...s[1]||(s[1]=[e("p",null,"该设备暂无配置记录",-1)])]))])]))]))}}),L=D(S,[["__scopeId","data-v-08e9c4cf"]]);export{L as default};
