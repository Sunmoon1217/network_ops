import{d as A,r as i,c as r,b as w,a,m as B,w as _,p as H,g as h,q as I,k as K,s as D,F as T,h as V,v as R,t as C,f as o,_ as N,l as W,o as q,x as M,y as F,z as U,i as Q}from"./index--L4D3a5E.js";import{a as L}from"./django_api-BTHqDO-9.js";const G={class:"simple-data-table"},J={key:0,class:"table-toolbar"},X={class:"table-wrapper"},Y=["innerHTML"],Z={key:2},ee={key:1,class:"table-pagination"},te=A({__name:"DataTable",props:{data:{default:()=>[]},columns:{default:()=>[]},loading:{type:Boolean,default:!1},pagination:{default:()=>({currentPage:1,pageSize:10,total:0,pageSizes:[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper"})},showPagination:{type:Boolean,default:!0},stripe:{type:Boolean,default:!0},border:{type:Boolean,default:!0}},emits:["page-change","size-change","refresh"],setup(u,{emit:k}){const v=u,f=k,g=i(v.pagination.currentPage||1),m=i(v.pagination.pageSize||10),y=i(v.pagination.total||0),$=s=>{m.value=s,f("size-change",s)},b=s=>{g.value=s,f("page-change",s)};return(s,p)=>{const c=D("el-table-column"),z=D("el-table"),S=D("el-pagination"),x=H("loading");return o(),r("div",G,[s.$slots.toolbar?(o(),r("div",J,[B(s.$slots,"toolbar",{},void 0,!0)])):w("",!0),a("div",X,[_((o(),h(z,{data:u.data,stripe:u.stripe,border:u.border},{default:I(()=>[u.columns.some(t=>t.type==="selection")?(o(),h(c,{key:0,type:"selection",width:"50"})):w("",!0),u.columns.some(t=>t.type==="index")?(o(),h(c,{key:1,type:"index",width:"60",label:"序号"})):w("",!0),(o(!0),r(T,null,V(u.columns.filter(t=>!t.type||t.type!=="selection"&&t.type!=="index"),t=>(o(),h(c,{key:t.prop,prop:t.prop,label:t.label,width:t.width,"min-width":t.minWidth,sortable:t.sortable,align:t.align,"show-overflow-tooltip":t.showOverflowTooltip},{default:I(d=>[t.renderCell?(o(),h(R(t.renderCell(d)),{key:0})):t.formatter?(o(),r("span",{key:1,innerHTML:t.formatter(d.row,t,d.row[t.prop],d.$index)},null,8,Y)):(o(),r("span",Z,C(d.row[t.prop]||"-"),1))]),_:2},1032,["prop","label","width","min-width","sortable","align","show-overflow-tooltip"]))),128)),s.$slots.actions?(o(),h(c,{key:2,label:"操作",width:"150",fixed:"right"},{default:I(t=>[B(s.$slots,"actions",{row:t.row,index:t.$index},void 0,!0)]),_:3})):w("",!0)]),_:3},8,["data","stripe","border"])),[[x,u.loading]])]),u.showPagination&&y.value>0?(o(),r("div",ee,[K(S,{"current-page":g.value,"onUpdate:currentPage":p[0]||(p[0]=t=>g.value=t),"page-size":m.value,"onUpdate:pageSize":p[1]||(p[1]=t=>m.value=t),"page-sizes":u.pagination.pageSizes,layout:u.pagination.layout,total:y.value,onSizeChange:$,onCurrentChange:b},null,8,["current-page","page-size","page-sizes","layout","total"])])):w("",!0)])}}}),ae=N(te,[["__scopeId","data-v-0e07cf90"]]),le={class:"interface-management-container"},ne={class:"filters-container"},oe={class:"filter-row"},se={class:"filter-item"},ie={class:"filter-item"},re=["value"],ue={class:"filter-item"},de=["value"],pe={class:"filter-item"},ce={key:0,class:"loading"},ve={key:1,class:"error"},ge={key:2,class:"interface-table-container"},fe=A({__name:"InterfaceManagementView",setup(u){Q();const k=i([]),v=i(!0),f=i(null),g=i(1),m=i(10),y=i(0),$=W(()=>({currentPage:g.value,pageSize:m.value,total:y.value,pageSizes:[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper"})),b=i(""),s=i("all"),p=i("all"),c=i(""),z=i([]),S=[{value:"all",label:"全部状态"},{value:"up",label:"启用"},{value:"down",label:"禁用"},{value:"admin_down",label:"管理关闭"}];async function x(){try{console.log("获取设备列表 - 发送请求");const n=await L.get("/devices/");console.log("获取设备列表 - 响应:",n),z.value=n.data?.results?.map(e=>({id:e.id,name:e.hostname}))||[]}catch(n){console.error("获取设备列表失败:",n)}}const t=i([{prop:"device_name",label:"设备名称",width:150,sortable:!0,formatter:n=>`<span class="clickable" @click="goToDeviceDetails(${n.device_id})"><i class="el-icon-view"></i> ${n.device_name||"-"}</span>`},{prop:"interface_name",label:"接口名称",width:180,sortable:!0},{prop:"description",label:"接口描述",minWidth:200,showOverflowTooltip:!0},{prop:"status",label:"状态",width:120,sortable:!0,formatter:n=>{const e={up:"启用",down:"禁用",admin_down:"管理关闭"};return`<span class="status-badge ${{up:"status-up",down:"status-down",admin_down:"status-admin"}[n.status]||""}">${e[n.status]||n.status}</span>`}}]);async function d(n=1){v.value=!0,f.value=null;try{const e={page:n,page_size:m.value};b.value&&(e.search=b.value),s.value!=="all"&&(e.status=s.value),p.value!=="all"&&(e.device=p.value),c.value&&(e.ip_address=c.value),console.log("发送API请求:",{url:"/config/interfaces/",params:e,baseURL:"/api"});const l=await L.get("/configs/interfaces/",{params:e});console.log("API响应:",l),k.value=l.data?.interfaces||[],y.value=l.data?.count||0,g.value=n}catch(e){console.error("API请求失败:",e),f.value=e instanceof Error?e.message:"获取接口配置失败"}finally{v.value=!1}}function O(){b.value="",s.value="all",p.value="all",c.value="",d(1)}function P(){d(1)}function j(n){g.value=n,d(n)}function E(n){m.value=n,d(1)}return q(async()=>{console.log("组件挂载 - 开始初始化数据"),await x(),console.log("组件挂载 - 设备列表获取完成，开始获取接口数据"),await d(),console.log("组件挂载 - 接口数据获取完成")}),(n,e)=>(o(),r("div",le,[e[11]||(e[11]=a("h2",null,"接口管理",-1)),a("div",ne,[a("div",oe,[a("div",se,[e[5]||(e[5]=a("label",{for:"search"},"搜索:",-1)),_(a("input",{id:"search","onUpdate:modelValue":e[0]||(e[0]=l=>b.value=l),type:"text",placeholder:"搜索接口名称、描述...",onKeyup:F(P,["enter"])},null,544),[[M,b.value]])]),a("div",ie,[e[6]||(e[6]=a("label",{for:"status"},"状态:",-1)),_(a("select",{id:"status","onUpdate:modelValue":e[1]||(e[1]=l=>s.value=l)},[(o(),r(T,null,V(S,l=>a("option",{key:l.value,value:l.value},C(l.label),9,re)),64))],512),[[U,s.value]])]),a("div",ue,[e[8]||(e[8]=a("label",{for:"device"},"设备:",-1)),_(a("select",{id:"device","onUpdate:modelValue":e[2]||(e[2]=l=>p.value=l)},[e[7]||(e[7]=a("option",{value:"all"},"所有设备",-1)),(o(!0),r(T,null,V(z.value,l=>(o(),r("option",{key:l.id,value:l.id},C(l.name),9,de))),128))],512),[[U,p.value]])]),a("div",pe,[e[9]||(e[9]=a("label",{for:"ip"},"IP地址:",-1)),_(a("input",{id:"ip","onUpdate:modelValue":e[3]||(e[3]=l=>c.value=l),type:"text",placeholder:"例如: 192.168.1.",onKeyup:F(P,["enter"])},null,544),[[M,c.value]])]),a("div",{class:"filter-buttons"},[a("button",{onClick:P,class:"apply-btn"},"应用过滤器"),a("button",{onClick:O,class:"reset-btn"},"重置")])])]),v.value?(o(),r("div",ce,[...e[10]||(e[10]=[a("p",null,"加载中...",-1)])])):f.value?(o(),r("div",ve,[a("p",null,"错误: "+C(f.value),1),a("button",{onClick:e[4]||(e[4]=l=>d(g.value)),class:"retry-btn"},"重试")])):(o(),r("div",ge,[K(ae,{data:k.value,columns:t.value,loading:v.value,pagination:$.value,"show-pagination":y.value>0,onPageChange:j,onSizeChange:E},null,8,["data","columns","loading","pagination","show-pagination"])]))]))}}),ye=N(fe,[["__scopeId","data-v-81491cca"]]);export{ye as default};
