import{d as A,r as i,g as j,c as r,b as z,a,m as D,z as F,w as C,A as H,j as _,s as S,B as R,u as W,C as q,x as Q,y as G,F as B,h as E,D as J,t as P,E as X,f as n,_ as K,o as Y,v as I,p as M,q as U,i as Z}from"./index.js";import{a as L}from"./django_api.js";/* empty css         *//* empty css        *//* empty css               */const ee={class:"simple-data-table"},te={key:0,class:"table-toolbar"},ae={style:{height:"60%"}},le=["innerHTML"],oe={key:2},ne={key:0,class:"table-pagination"},se=A({__name:"DataTable",props:{data:{default:()=>[]},columns:{default:()=>[]},loading:{type:Boolean,default:!1},pagination:{default:()=>({currentPage:1,pageSize:10,total:0,pageSizes:[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper"})},showPagination:{type:Boolean,default:!0},stripe:{type:Boolean,default:!0},border:{type:Boolean,default:!0}},emits:["page-change","size-change","refresh"],setup(d,{emit:k}){const p=d,m=k,v=i(p.pagination.currentPage||1),c=i(p.pagination.pageSize||10),w=i(p.pagination.total||0),V=o=>{c.value=o,m("size-change",o)},b=o=>{v.value=o,m("page-change",o)},h=j(()=>{const o=(v.value-1)*c.value,u=o+c.value;return p.data.slice(o,u)});return(o,u)=>{const y=G,$=Q,x=X,T=R,f=H;return n(),r("div",ee,[o.$slots.toolbar?(n(),r("div",te,[F(o.$slots,"toolbar",{},void 0,!0)])):z("",!0),a("div",ae,[C((n(),_($,{data:h.value,stripe:d.stripe,border:d.border,height:"100%"},{default:S(()=>[d.columns.some(t=>t.type==="selection")?(n(),_(y,{key:0,type:"selection",width:"50"})):z("",!0),d.columns.some(t=>t.type==="index")?(n(),_(y,{key:1,type:"index",width:"60",label:"序号"})):z("",!0),(n(!0),r(B,null,E(d.columns.filter(t=>!t.type||t.type!=="selection"&&t.type!=="index"),t=>(n(),_(y,{key:t.prop,prop:t.prop,label:t.label,width:t.width,"min-width":t.minWidth,sortable:t.sortable,align:t.align,"show-overflow-tooltip":t.showOverflowTooltip},{default:S(g=>[t.renderCell?(n(),_(J(t.renderCell(g)),{key:0})):t.formatter?(n(),r("span",{key:1,innerHTML:t.formatter(g.row,t,g.row[t.prop],g.$index)},null,8,le)):(n(),r("span",oe,P(g.row[t.prop]||"-"),1))]),_:2},1032,["prop","label","width","min-width","sortable","align","show-overflow-tooltip"]))),128)),o.$slots.actions?(n(),_(y,{key:2,label:"操作",width:"150",fixed:"right"},{default:S(t=>[F(o.$slots,"actions",{row:t.row,index:t.$index},void 0,!0)]),_:3})):z("",!0)]),_:3},8,["data","stripe","border"])),[[f,d.loading]])]),D(T,{locale:W(q)},{default:S(()=>[d.showPagination&&w.value>0?(n(),r("div",ne,[D(x,{"current-page":v.value,"onUpdate:currentPage":u[0]||(u[0]=t=>v.value=t),"page-size":c.value,"onUpdate:pageSize":u[1]||(u[1]=t=>c.value=t),"page-sizes":d.pagination.pageSizes,layout:d.pagination.layout,total:w.value,onSizeChange:V,onCurrentChange:b},null,8,["current-page","page-size","page-sizes","layout","total"])])):z("",!0)]),_:1},8,["locale"])])}}}),ie=K(se,[["__scopeId","data-v-3b64852c"]]),re={class:"virtual-management-container"},ue={class:"filters-container"},de={class:"filter-row"},pe={class:"filter-item"},ve={class:"filter-item"},ce=["value"],ge={class:"filter-item"},fe=["value"],me={class:"filter-item"},be={key:0,class:"loading"},he={key:1,class:"error"},ye={key:2,class:"virtual-table-container"},we=A({__name:"VirtualManagementView",setup(d){Z();const k=i([]),p=i(!0),m=i(null),v=i(1),c=i(15),w=i(0),V=j(()=>({currentPage:v.value,pageSize:c.value,total:w.value,pageSizes:[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper"})),b=i(""),h=i("all"),o=i("all"),u=i(""),y=i([]),$=[{value:"all",label:"全部状态"},{value:"up",label:"启用"},{value:"down",label:"禁用"},{value:"admin_down",label:"管理关闭"}];async function x(){try{console.log("获取设备列表 - 发送请求");const s=await L.get("/devices/");console.log("获取设备列表 - 响应:",s),y.value=s.data?.results?.map(e=>({id:e.id,name:e.hostname}))||[]}catch(s){console.error("获取设备列表失败:",s)}}const T=i([{prop:"device_name",label:"设备名称",width:260,sortable:!0,formatter:s=>`<span class="clickable" @click="goToDeviceDetails(${s.device_id})"><i class="el-icon-view"></i> ${s.device_name||"-"}</span>`},{prop:"name",label:"VS名称",width:260,sortable:!0},{prop:"pool",label:"Pool",minWidth:200,showOverflowTooltip:!0},{prop:"vs_address",label:"VS地址",width:120,sortable:!0},{prop:"vs_port",label:"VS端口",width:120,sortable:!0}]);async function f(s=1){p.value=!0,m.value=null;try{const e={page:s,page_size:c.value};b.value&&(e.search=b.value),h.value!=="all"&&(e.status=h.value),o.value!=="all"&&(e.device=o.value),u.value&&(e.ip_address=u.value),console.log("发送API请求:",{url:"/virtuals/",params:e,baseURL:"/api"});const l=await L.get("/virtuals/",{params:e});console.log("API响应:",l),k.value=l.data?.results||[],w.value=l.data?.count||0,v.value=s}catch(e){console.error("API请求失败:",e),m.value=e instanceof Error?e.message:"获取VS配置失败"}finally{p.value=!1}}function t(){b.value="",h.value="all",o.value="all",u.value="",f(1)}function g(){f(1)}function N(s){v.value=s,f(s)}function O(s){c.value=s,f(1)}return Y(async()=>{console.log("组件挂载 - 开始初始化数据"),await x(),console.log("组件挂载 - 设备列表获取完成，开始获取接口数据"),await f(),console.log("组件挂载 - 接口数据获取完成")}),(s,e)=>(n(),r("div",re,[e[11]||(e[11]=a("h2",null,"接口管理",-1)),a("div",ue,[a("div",de,[a("div",pe,[e[5]||(e[5]=a("label",{for:"search"},"搜索:",-1)),C(a("input",{id:"search","onUpdate:modelValue":e[0]||(e[0]=l=>b.value=l),type:"text",placeholder:"搜索接口名称、描述...",onKeyup:M(g,["enter"])},null,544),[[I,b.value]])]),a("div",ve,[e[6]||(e[6]=a("label",{for:"status"},"状态:",-1)),C(a("select",{id:"status","onUpdate:modelValue":e[1]||(e[1]=l=>h.value=l)},[(n(),r(B,null,E($,l=>a("option",{key:l.value,value:l.value},P(l.label),9,ce)),64))],512),[[U,h.value]])]),a("div",ge,[e[8]||(e[8]=a("label",{for:"device"},"设备:",-1)),C(a("select",{id:"device","onUpdate:modelValue":e[2]||(e[2]=l=>o.value=l)},[e[7]||(e[7]=a("option",{value:"all"},"所有设备",-1)),(n(!0),r(B,null,E(y.value,l=>(n(),r("option",{key:l.id,value:l.id},P(l.name),9,fe))),128))],512),[[U,o.value]])]),a("div",me,[e[9]||(e[9]=a("label",{for:"ip"},"IP地址:",-1)),C(a("input",{id:"ip","onUpdate:modelValue":e[3]||(e[3]=l=>u.value=l),type:"text",placeholder:"例如: 192.168.1.",onKeyup:M(g,["enter"])},null,544),[[I,u.value]])]),a("div",{class:"filter-buttons"},[a("button",{onClick:g,class:"apply-btn"},"应用过滤器"),a("button",{onClick:t,class:"reset-btn"},"重置")])])]),p.value?(n(),r("div",be,[...e[10]||(e[10]=[a("p",null,"加载中...",-1)])])):m.value?(n(),r("div",he,[a("p",null,"错误: "+P(m.value),1),a("button",{onClick:e[4]||(e[4]=l=>f(v.value)),class:"retry-btn"},"重试")])):(n(),r("div",ye,[D(ie,{data:k.value,columns:T.value,loading:p.value,pagination:V.value,"show-pagination":w.value>0,onPageChange:N,onSizeChange:O},null,8,["data","columns","loading","pagination","show-pagination"])]))]))}}),Pe=K(we,[["__scopeId","data-v-ff9467e4"]]);export{Pe as default};
