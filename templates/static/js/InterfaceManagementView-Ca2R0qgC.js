import{d as B,r as s,m as k,o as K,c as o,a,w as b,v as P,p as I,q as V,F as z,i as C,t as y,l as N,g as $,f as n,_ as E}from"./index-BvaCPVuh.js";import{a as S}from"./django_api-BTHqDO-9.js";import{D as L}from"./DataTable-Chjg_1bM.js";const O={class:"interface-management-container"},R={class:"filters-container"},j={class:"filter-row"},q={class:"filter-item"},Q={class:"filter-item"},W=["value"],G={class:"filter-item"},H=["value"],J={class:"filter-item"},X={key:0,class:"loading"},Y={key:1,class:"error"},Z={key:2,class:"interface-table-container"},ee=B({__name:"InterfaceManagementView",emits:["page-change","size-change","refresh"],setup(ae,{emit:te}){$();const f=s([]),m=s(!0),g=s(null),r=s(1),u=s(15),h=s(0),x=k(()=>({currentPage:r.value,pageSize:u.value,total:h.value,pageSizes:[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper"}));k(()=>{const t=(r.value-1)*u.value,e=t+u.value;if(f)return f.value.slice(t,e)});const d=s(""),c=s("all"),v=s("all"),p=s(""),_=s([]),D=[{value:"all",label:"全部状态"},{value:"up",label:"启用"},{value:"down",label:"禁用"},{value:"admin_down",label:"管理关闭"}];async function F(){try{console.log("获取设备列表 - 发送请求");const t=await S.get("/devices/");console.log("获取设备列表 - 响应:",t),_.value=t.data?.results?.map(e=>({id:e.id,name:e.hostname}))||[]}catch(t){console.error("获取设备列表失败:",t)}}const U=s([{prop:"device_name",label:"设备名称",width:230,sortable:!0,formatter:t=>`<span class="clickable" @click="goToDeviceDetails(${t.device_id})"><i class="el-icon-view"></i> ${t.device_name||"-"}</span>`},{prop:"interface",label:"接口名称",width:200,sortable:!0},{prop:"description",label:"接口描述",minWidth:200,showOverflowTooltip:!0},{prop:"vrf",label:"VPN实例",width:150,sortable:!0},{prop:"if_address",label:"接口地址",width:180,sortable:!0},{prop:"shutdown",label:"状态",width:120,sortable:!0,formatter:t=>t.shutdown?"Shutdown":"UP"}]);async function i(t=1){m.value=!0,g.value=null;try{const e={page:t,page_size:u.value};d.value&&(e.search=d.value),c.value!=="all"&&(e.status=c.value),v.value!=="all"&&(e.device=v.value),p.value&&(e.ip_address=p.value),console.log("发送API请求:",{url:"/config/interfaces/",params:e,baseURL:"/api"});const l=await S.get("/configs/interfaces/",{params:e});console.log("API响应:",l),f.value=l.data?.interfaces||[],h.value=l.data?.count||0,r.value=t}catch(e){console.error("API请求失败:",e),g.value=e instanceof Error?e.message:"获取接口配置失败"}finally{m.value=!1}}function M(){d.value="",c.value="all",v.value="all",p.value="",i(1)}function w(){i(1)}function T(t){r.value=t,i(t)}function A(t){u.value=t,i(1)}return K(async()=>{console.log("组件挂载 - 开始初始化数据"),await F(),console.log("组件挂载 - 设备列表获取完成，开始获取接口数据"),await i(),console.log("组件挂载 - 接口数据获取完成")}),(t,e)=>(n(),o("div",O,[e[11]||(e[11]=a("h2",null,"接口管理",-1)),a("div",R,[a("div",j,[a("div",q,[e[5]||(e[5]=a("label",{for:"search"},"搜索:",-1)),b(a("input",{id:"search","onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l),type:"text",placeholder:"搜索接口名称、描述...",onKeyup:I(w,["enter"])},null,544),[[P,d.value]])]),a("div",Q,[e[6]||(e[6]=a("label",{for:"status"},"状态:",-1)),b(a("select",{id:"status","onUpdate:modelValue":e[1]||(e[1]=l=>c.value=l)},[(n(),o(z,null,C(D,l=>a("option",{key:l.value,value:l.value},y(l.label),9,W)),64))],512),[[V,c.value]])]),a("div",G,[e[8]||(e[8]=a("label",{for:"device"},"设备:",-1)),b(a("select",{id:"device","onUpdate:modelValue":e[2]||(e[2]=l=>v.value=l)},[e[7]||(e[7]=a("option",{value:"all"},"所有设备",-1)),(n(!0),o(z,null,C(_.value,l=>(n(),o("option",{key:l.id,value:l.id},y(l.name),9,H))),128))],512),[[V,v.value]])]),a("div",J,[e[9]||(e[9]=a("label",{for:"ip"},"IP地址:",-1)),b(a("input",{id:"ip","onUpdate:modelValue":e[3]||(e[3]=l=>p.value=l),type:"text",placeholder:"例如: 192.168.1.",onKeyup:I(w,["enter"])},null,544),[[P,p.value]])]),a("div",{class:"filter-buttons"},[a("button",{onClick:w,class:"apply-btn"},"应用过滤器"),a("button",{onClick:M,class:"reset-btn"},"重置")])])]),m.value?(n(),o("div",X,[...e[10]||(e[10]=[a("p",null,"加载中...",-1)])])):g.value?(n(),o("div",Y,[a("p",null,"错误: "+y(g.value),1),a("button",{onClick:e[4]||(e[4]=l=>i(r.value)),class:"retry-btn"},"重试")])):(n(),o("div",Z,[N(L,{data:f.value,columns:U.value,loading:m.value,pagination:x.value,"show-pagination":h.value>0,onPageChange:T,onSizeChange:A},null,8,["data","columns","loading","pagination","show-pagination"])]))]))}}),ne=E(ee,[["__scopeId","data-v-336282e2"]]);export{ne as default};
