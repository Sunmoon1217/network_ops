import{d as x,r as n,o as z,k as I,c as s,a as e,t as c,b as P,F as V,i as $,l as B,g as N,n as S,f as a,_ as L}from"./index-CPZ48B5U.js";import{a as y}from"./django_api-BTHqDO-9.js";import{P as E}from"./Pagination-FITBZrDY.js";const F={class:"history-container"},H={key:0,class:"loading"},M={key:1,class:"error"},R={key:2,class:"history-content"},U={class:"device-header"},j={class:"history-wrapper"},q={class:"config-list"},A={key:0,class:"no-configs"},G={key:1,class:"config-items"},J=["onClick"],K={class:"config-time"},O={class:"config-id"},Q={key:2,class:"pagination-container"},T={class:"config-detail"},W={key:0,class:"detail-content"},X={class:"detail-header"},Y={class:"detail-meta"},Z={class:"config-text"},ee={key:1,class:"no-selected"},te=x({__name:"DeviceConfigHistoryView",setup(se){const C=I(),g=N(),d=n(null),h=n(""),u=n([]),l=n(null),_=n(!0),r=n(null),p=n(1),f=n(10),v=n(0),k=n(1);function w(){g.options.history.state.back?g.back():g.push(`/devices/${d.value}/config`)}async function m(o=1){_.value=!0,r.value=null;try{const t=await y.get(`/devices/${d.value}/`);h.value=t.data?.hostname||"";const i=await y.get(`/configs/?device=${d.value}&ordering=-time`,{params:{page:o,page_size:f.value}});u.value=i.data?.results||[],v.value=i.data.count||0,k.value=Math.ceil(v.value/f.value),p.value=o,u.value.length>0&&(l.value=u.value[0]||null)}catch(t){r.value=t instanceof Error?t.message:"Unknown error"}finally{_.value=!1}}function D(o){m(o)}function b(o){l.value=o}return z(()=>{const o=C.params.id;typeof o=="string"&&(d.value=parseInt(o),m())}),(o,t)=>(a(),s("div",F,[t[6]||(t[6]=e("h2",null,"设备历史配置",-1)),_.value?(a(),s("div",H,[...t[1]||(t[1]=[e("p",null,"加载中...",-1)])])):r.value?(a(),s("div",M,[e("p",null,"错误: "+c(r.value),1),e("button",{onClick:t[0]||(t[0]=i=>m(p.value))},"重试")])):(a(),s("div",R,[e("div",U,[e("h3",null,"设备: "+c(h.value),1),e("div",{class:"header-actions"},[e("button",{onClick:w,class:"back-btn"},"返回")])]),e("div",j,[e("div",q,[t[3]||(t[3]=e("h4",null,"配置历史",-1)),u.value.length===0?(a(),s("div",A,[...t[2]||(t[2]=[e("p",null,"该设备暂无配置记录",-1)])])):(a(),s("ul",G,[(a(!0),s(V,null,$(u.value,i=>(a(),s("li",{key:i.id,class:S(["config-item",{active:l.value?.id===i.id}]),onClick:ae=>b(i)},[e("div",K,c(new Date(i.time).toLocaleString()),1),e("div",O,"#"+c(i.id),1)],10,J))),128))])),v.value>0?(a(),s("div",Q,[B(E,{"current-page":p.value,"total-pages":k.value,"page-size":f.value,"total-items":v.value,"on-page-change":D},null,8,["current-page","total-pages","page-size","total-items"])])):P("",!0)]),e("div",T,[l.value?(a(),s("div",W,[e("div",X,[t[4]||(t[4]=e("h4",null,"配置详情",-1)),e("div",Y,[e("span",null,"配置ID: "+c(l.value.id),1),e("span",null,"保存时间: "+c(new Date(l.value.time).toLocaleString()),1)])]),e("pre",Z,c(l.value.config_text),1)])):(a(),s("div",ee,[...t[5]||(t[5]=[e("p",null,"请选择一个配置查看详情",-1)])]))])])]))]))}}),le=L(te,[["__scopeId","data-v-a009f8ac"]]);export{le as default};
