import{d as A,r as s,m as B,o as K,c as o,a as l,w as f,v as V,p as k,q as S,F as P,i as C,t as _,l as $,g as E,f as n,_ as L}from"./index-BvaCPVuh.js";import{a as x}from"./django_api-BTHqDO-9.js";import{D as N}from"./DataTable-Chjg_1bM.js";const O={class:"virtual-management-container"},R={class:"filters-container"},j={class:"filter-row"},q={class:"filter-item"},Q={class:"filter-item"},W=["value"],G={class:"filter-item"},H=["value"],J={class:"filter-item"},X={key:0,class:"loading"},Y={key:1,class:"error"},Z={key:2,class:"virtual-table-container"},ee=A({__name:"VirtualManagementView",setup(le){E();const w=s([]),c=s(!0),p=s(null),m=s(1),g=s(10),b=s(0),z=B(()=>({currentPage:m.value,pageSize:g.value,total:b.value,pageSizes:[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper"})),u=s(""),r=s("all"),v=s("all"),d=s(""),h=s([]),D=[{value:"all",label:"全部状态"},{value:"up",label:"启用"},{value:"down",label:"禁用"},{value:"admin_down",label:"管理关闭"}];async function F(){try{console.log("获取设备列表 - 发送请求");const t=await x.get("/devices/");console.log("获取设备列表 - 响应:",t),h.value=t.data?.results?.map(e=>({id:e.id,name:e.hostname}))||[]}catch(t){console.error("获取设备列表失败:",t)}}const I=s([{prop:"device_name",label:"设备名称",width:150,sortable:!0,formatter:t=>`<span class="clickable" @click="goToDeviceDetails(${t.device_id})"><i class="el-icon-view"></i> ${t.device_name||"-"}</span>`},{prop:"name",label:"VS名称",width:200,sortable:!0},{prop:"pool",label:"Pool",minWidth:200,showOverflowTooltip:!0},{prop:"vs_address",label:"VS地址",width:120,sortable:!0},{prop:"vs_port",label:"VS端口",width:120,sortable:!0}]);async function i(t=1){c.value=!0,p.value=null;try{const e={page:t,page_size:g.value};u.value&&(e.search=u.value),r.value!=="all"&&(e.status=r.value),v.value!=="all"&&(e.device=v.value),d.value&&(e.ip_address=d.value),console.log("发送API请求:",{url:"/config/virtuals/",params:e,baseURL:"/api"});const a=await x.get("/configs/virtuals/",{params:e});console.log("API响应:",a),w.value=a.data?.virtuals||[],b.value=a.data?.count||0,m.value=t}catch(e){console.error("API请求失败:",e),p.value=e instanceof Error?e.message:"获取VS配置失败"}finally{c.value=!1}}function M(){u.value="",r.value="all",v.value="all",d.value="",i(1)}function y(){i(1)}function U(t){m.value=t,i(t)}function T(t){g.value=t,i(1)}return K(async()=>{console.log("组件挂载 - 开始初始化数据"),await F(),console.log("组件挂载 - 设备列表获取完成，开始获取接口数据"),await i(),console.log("组件挂载 - 接口数据获取完成")}),(t,e)=>(n(),o("div",O,[e[11]||(e[11]=l("h2",null,"接口管理",-1)),l("div",R,[l("div",j,[l("div",q,[e[5]||(e[5]=l("label",{for:"search"},"搜索:",-1)),f(l("input",{id:"search","onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),type:"text",placeholder:"搜索接口名称、描述...",onKeyup:k(y,["enter"])},null,544),[[V,u.value]])]),l("div",Q,[e[6]||(e[6]=l("label",{for:"status"},"状态:",-1)),f(l("select",{id:"status","onUpdate:modelValue":e[1]||(e[1]=a=>r.value=a)},[(n(),o(P,null,C(D,a=>l("option",{key:a.value,value:a.value},_(a.label),9,W)),64))],512),[[S,r.value]])]),l("div",G,[e[8]||(e[8]=l("label",{for:"device"},"设备:",-1)),f(l("select",{id:"device","onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a)},[e[7]||(e[7]=l("option",{value:"all"},"所有设备",-1)),(n(!0),o(P,null,C(h.value,a=>(n(),o("option",{key:a.id,value:a.id},_(a.name),9,H))),128))],512),[[S,v.value]])]),l("div",J,[e[9]||(e[9]=l("label",{for:"ip"},"IP地址:",-1)),f(l("input",{id:"ip","onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),type:"text",placeholder:"例如: 192.168.1.",onKeyup:k(y,["enter"])},null,544),[[V,d.value]])]),l("div",{class:"filter-buttons"},[l("button",{onClick:y,class:"apply-btn"},"应用过滤器"),l("button",{onClick:M,class:"reset-btn"},"重置")])])]),c.value?(n(),o("div",X,[...e[10]||(e[10]=[l("p",null,"加载中...",-1)])])):p.value?(n(),o("div",Y,[l("p",null,"错误: "+_(p.value),1),l("button",{onClick:e[4]||(e[4]=a=>i(m.value)),class:"retry-btn"},"重试")])):(n(),o("div",Z,[$(N,{data:w.value,columns:I.value,loading:c.value,pagination:z.value,"show-pagination":b.value>0,onPageChange:U,onSizeChange:T},null,8,["data","columns","loading","pagination","show-pagination"])]))]))}}),oe=L(ee,[["__scopeId","data-v-c8746868"]]);export{oe as default};
